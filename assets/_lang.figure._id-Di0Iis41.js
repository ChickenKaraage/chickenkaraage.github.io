import{l as f,t as x,B as v,w as E}from"./root-C644_bSx.js";import{j as e,L as N,r as b,u as I}from"./chunk-K6CSEXPM-CZM0g_7M.js";import{a as k,g as $}from"./figure-service-DwnftWDA.js";import"./preload-helper-D7HrI6pR.js";function C({events:o,title:i,lang:a}){const t=[...f(o,a)].sort((n,c)=>{const u=parseInt(n.date.split("-")[0]),g=parseInt(c.date.split("-")[0]);return u-g});return e.jsxs("div",{className:"my-8",children:[i&&e.jsx("h3",{className:"text-xl font-bold mb-4",children:i}),e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:t.map((n,c)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-10 w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[n.eventId?e.jsx(N,{to:`${v}/${a}/event/${n.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[n.title,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:n.title}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:n.date}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:n.description})]})]},c))})]})}function F({person1Events:o,person2Events:i,person1Name:a,person2Name:r,lang:t}){const n=f(o,t),c=f(i,t),u=n.map(s=>({...s,person:a,personIndex:1,eventKey:s.eventId||`${s.date}-${s.title}`})),g=c.map(s=>({...s,person:r,personIndex:2,eventKey:s.eventId||`${s.date}-${s.title}`})),h=new Map;u.forEach(s=>{h.set(s.eventKey,{person1Event:s,person2Event:null,date:s.date,eventId:s.eventId})}),g.forEach(s=>{if(h.has(s.eventKey)){const d=h.get(s.eventKey);d.person2Event=s}else h.set(s.eventKey,{person1Event:null,person2Event:s,date:s.date,eventId:s.eventId})});const y=Array.from(h.values()).sort((s,d)=>{const l=parseInt(s.date.split("-")[0]),p=parseInt(d.date.split("-")[0]);return l-p});return e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:x("comparativeTimeline",t)}),e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-600 mr-2"}),e.jsx("span",{className:"mr-6 font-medium",children:a}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-600 mr-2"}),e.jsx("span",{className:"font-medium",children:r})]}),e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:y.map((s,d)=>{const{person1Event:l,person2Event:p}=s,j=l&&p,m=l||p;if(!m)return null;const w=j?"bg-purple-600":l?"bg-blue-600":"bg-red-600";return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-10 w-6 h-6 rounded-full ${w} flex items-center justify-center`,children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[m.eventId?e.jsx(N,{to:`${v}/${t}/event/${m.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[j?m.title:`${m.person}: ${m.title}`,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:j?m.title:`${m.person}: ${m.title}`}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[m.date,j&&e.jsxs("span",{className:"font-medium ml-2",children:["• ",x("participatedBy",t)," ",a," & ",r]})]}),j?e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[a,": "]}),l.description]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[r,": "]}),p.description]})]})]}):e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:m.description})]})]},d)})})]})}function z({relationship:o,lang:i}){const a=f(o,i);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:e.jsx(N,{to:`${v}/${i}/figure/${a.personId}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:a.name})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.relationship})]})}),e.jsx("h4",{className:"text-md font-semibold mb-2",children:x("keyInteractions",i)}),e.jsx("ul",{className:"space-y-2",children:a.interactions.map((r,t)=>e.jsx(S,{interaction:r},t))})]})}function S({interaction:o}){return e.jsxs("li",{className:"flex",children:[e.jsx("div",{className:"w-16 flex-shrink-0 text-sm text-gray-600 dark:text-gray-400",children:o.date}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:o.description})]})}function D({currentFigure:o,allFigures:i,lang:a}){const[r,t]=b.useState(""),[n,c]=b.useState(null),[u,g]=b.useState(!1);b.useEffect(()=>{if(n&&r){const s=i.find(d=>d.id===r);s?c(s):(async()=>{try{const l=await k(r);if(l){const p=f(l,a);c(p)}}catch(l){console.error("Error updating comparison figure:",l)}})()}},[a,i,r]);const h=async()=>{if(r){g(!0);try{const s=i.find(d=>d.id===r);if(s)c(s);else{const d=await k(r);if(d){const l=f(d,a);c(l)}else console.error("No figure found with ID:",r)}}catch(s){console.error("Error loading comparison figure:",s)}finally{g(!1)}}},y=()=>{c(null),t("")};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{className:"flex-1 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200",value:r,onChange:s=>t(s.target.value),disabled:u||!!n,children:[e.jsxs("option",{value:"",children:[x("compareWith",a),"..."]}),i.filter(s=>s.id!==o.id).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),n?e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:x("clearComparison",a)}):e.jsx("button",{onClick:h,disabled:!r||u,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:u?e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-1"}):x("compare",a)})]}),n&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:[x("comparingWith",a)," ",e.jsx("span",{className:"font-medium",children:n.name})]}),n?e.jsx(F,{person1Events:o.lifeEvents,person2Events:n.lifeEvents,person1Name:o.name,person2Name:n.name,lang:a}):e.jsx(C,{events:o.lifeEvents,title:"",lang:a})]})}const P=E(function(){const i=I(),a=i.id,r=i.lang==="zh"?"zh":"en",[t,n]=b.useState(null),[c,u]=b.useState([]),[g,h]=b.useState(!0),[y,s]=b.useState(null);return b.useEffect(()=>{async function d(){try{h(!0);const[l,p]=await Promise.all([k(a),$()]);if(l){const j=f(l,r),m=f(p,r);n(j),u(m)}else s("Figure not found")}catch(l){s("Error loading figure data"),console.error(l)}finally{h(!1)}}d()},[a,r]),g?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:"Loading..."}):y||!t?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-red-800 dark:text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mb-4",children:y||"Figure not found"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors cursor-pointer",children:"← Go Back"}),e.jsx(N,{to:`${v}/${r}`,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Go to Home"})]})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(N,{to:`${v}/${r}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:["← ",x("backToHome",r)]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 mb-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:t.name}),e.jsxs("div",{className:"text-lg text-gray-600 dark:text-gray-400 mb-4",children:[t.birth," - ",t.death||x("present",r)]}),e.jsx("div",{className:"mb-6",children:t.titles.map((d,l)=>e.jsx("span",{className:"inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm px-3 py-1 rounded-full mr-2 mb-2",children:d},l))}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3",children:x("biography",r)}),e.jsx("p",{className:"mb-6",children:t.biography}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:x("significance",r)}),e.jsx("p",{children:t.significance})]})]}),e.jsx("div",{className:"w-full md:w-64 h-80 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:t.name})})]}),e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:x("lifeEvents",r)}),e.jsx(D,{currentFigure:t,allFigures:c,lang:r})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4 mt-10",children:x("keyRelationships",r)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.relationships.map((d,l)=>e.jsx(z,{relationship:d,lang:r},l))})]})});export{P as default};
