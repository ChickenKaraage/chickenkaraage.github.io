import{l as g,B as v,t as m,w as E}from"./root-Dd_dAHNP.js";import{j as e,L as N,r as b,u as I}from"./chunk-K6CSEXPM-CZM0g_7M.js";import{a as k,g as $}from"./figure-service-DwnftWDA.js";import"./preload-helper-D7HrI6pR.js";function C({relationship:o,lang:d}){const t=g(o,d);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:e.jsx(N,{to:`${v}/${d}/figure/${t.personId}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:t.name})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.relationship})]})}),e.jsx("h4",{className:"text-md font-semibold mb-2",children:m("keyInteractions",d)}),e.jsx("ul",{className:"space-y-2",children:t.interactions.map((r,a)=>e.jsx(F,{interaction:r},a))})]})}function F({interaction:o}){return e.jsxs("li",{className:"flex",children:[e.jsx("div",{className:"w-16 flex-shrink-0 text-sm text-gray-600 dark:text-gray-400",children:o.date}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:o.description})]})}function z({events:o,lang:d}){const r=[...g(o,d)].sort((a,i)=>{const x=parseInt(a.date.split("-")[0]),u=parseInt(i.date.split("-")[0]);return x-u});return e.jsx("div",{className:"my-8",children:e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:r.map((a,i)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-10 w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[a.eventId?e.jsx(N,{to:`${v}/${d}/event/${a.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[a.title,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:a.title}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:a.date}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:a.description})]})]},i))})})}function S({person1Events:o,person2Events:d,person1Name:t,person2Name:r,lang:a}){const i=g(o,a),x=g(d,a),u=i.map(s=>({...s,person:t,personIndex:1,eventKey:s.eventId||`${s.date}-${s.title}`})),j=x.map(s=>({...s,person:r,personIndex:2,eventKey:s.eventId||`${s.date}-${s.title}`})),h=new Map;u.forEach(s=>{h.set(s.eventKey,{person1Event:s,person2Event:null,date:s.date,eventId:s.eventId})}),j.forEach(s=>{if(h.has(s.eventKey)){const n=h.get(s.eventKey);n.person2Event=s}else h.set(s.eventKey,{person1Event:null,person2Event:s,date:s.date,eventId:s.eventId})});const y=Array.from(h.values()).sort((s,n)=>{const l=parseInt(s.date.split("-")[0]),p=parseInt(n.date.split("-")[0]);return l-p});return e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:m("comparativeTimeline",a)}),e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-600 mr-2"}),e.jsx("span",{className:"mr-6 font-medium",children:t}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-600 mr-2"}),e.jsx("span",{className:"font-medium",children:r})]}),e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:y.map((s,n)=>{const{person1Event:l,person2Event:p}=s,f=l&&p,c=l||p;if(!c)return null;const w=f?"bg-purple-600":l?"bg-blue-600":"bg-red-600";return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-10 w-6 h-6 rounded-full ${w} flex items-center justify-center`,children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[c.eventId?e.jsx(N,{to:`${v}/${a}/event/${c.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[f?c.title:`${c.person}: ${c.title}`,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:f?c.title:`${c.person}: ${c.title}`}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[c.date,f&&e.jsxs("span",{className:"font-medium ml-2",children:["• ",m("participatedBy",a)," ",t," & ",r]})]}),f?e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[t,": "]}),l.description]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[r,": "]}),p.description]})]})]}):e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:c.description})]})]},n)})})]})}function D({currentFigure:o,allFigures:d,lang:t}){const[r,a]=b.useState(""),[i,x]=b.useState(null),[u,j]=b.useState(!1);b.useEffect(()=>{if(i&&r){const s=d.find(n=>n.id===r);s?x(s):(async()=>{try{const l=await k(r);if(l){const p=g(l,t);x(p)}}catch(l){console.error("Error updating comparison figure:",l)}})()}},[t,d,r]);const h=async()=>{if(r){j(!0);try{const s=d.find(n=>n.id===r);if(s)x(s);else{const n=await k(r);if(n){const l=g(n,t);x(l)}else console.error("No figure found with ID:",r)}}catch(s){console.error("Error loading comparison figure:",s)}finally{j(!1)}}},y=()=>{x(null),a("")};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{className:"flex-1 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200",value:r,onChange:s=>a(s.target.value),disabled:u||!!i,children:[e.jsxs("option",{value:"",children:[m("compareWith",t),"..."]}),d.filter(s=>s.id!==o.id).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i?e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:m("clearComparison",t)}):e.jsx("button",{onClick:h,disabled:!r||u,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:u?e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-1"}):m("compare",t)})]}),i&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:[m("comparingWith",t)," ",e.jsx("span",{className:"font-medium",children:i.name})]}),i?e.jsx(S,{person1Events:o.lifeEvents,person2Events:i.lifeEvents,person1Name:o.name,person2Name:i.name,lang:t}):e.jsx(z,{events:o.lifeEvents,lang:t})]})}const P=E(function(){const d=I(),t=d.id,r=d.lang==="zh"?"zh":"en",[a,i]=b.useState(null),[x,u]=b.useState([]),[j,h]=b.useState(!0),[y,s]=b.useState(null);return b.useEffect(()=>{async function n(){try{h(!0);const[l,p]=await Promise.all([k(t),$()]);if(l){const f=g(l,r),c=g(p,r);i(f),u(c)}else s("Figure not found")}catch(l){s("Error loading figure data"),console.error(l)}finally{h(!1)}}n()},[t,r]),j?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:"Loading..."}):y||!a?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-red-800 dark:text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mb-4",children:y||"Figure not found"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors cursor-pointer",children:"← Go Back"}),e.jsx(N,{to:`${v}/${r}`,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Go to Home"})]})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(N,{to:`${v}/${r}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:["← ",m("backToHome",r)]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 mb-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:a.name}),e.jsxs("div",{className:"text-lg text-gray-600 dark:text-gray-400 mb-4",children:[a.birth," - ",a.death||m("present",r)]}),e.jsx("div",{className:"mb-6",children:a.titles.map((n,l)=>e.jsx("span",{className:"inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm px-3 py-1 rounded-full mr-2 mb-2",children:n},l))}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3",children:m("biography",r)}),e.jsx("p",{className:"mb-6",children:a.biography}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:m("significance",r)}),e.jsx("p",{children:a.significance})]})]}),e.jsx("div",{className:"w-full md:w-64 h-80 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden flex items-center justify-center",children:e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Placeholder image - ",a.name]})})]}),e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:m("lifeEvents",r)}),e.jsx(D,{currentFigure:a,allFigures:x,lang:r})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4 mt-10",children:m("keyRelationships",r)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.relationships.map((n,l)=>e.jsx(C,{relationship:n,lang:r},l))})]})});export{P as default};
