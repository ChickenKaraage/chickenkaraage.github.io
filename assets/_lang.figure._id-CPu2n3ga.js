import{l as b,t as x,B as v,w}from"./root-Bm4UJU2i.js";import{j as e,L as N,r as g,u as I}from"./chunk-K6CSEXPM-CZM0g_7M.js";import{a as k,g as $}from"./figure-service-DMjqi4DT.js";import"./preload-helper-BrSc9U5X.js";function C({events:o,title:d,lang:r}){const t=[...b(o,r)].sort((n,c)=>{const h=parseInt(n.date.split("-")[0]),f=parseInt(c.date.split("-")[0]);return h-f});return e.jsxs("div",{className:"my-8",children:[d&&e.jsx("h3",{className:"text-xl font-bold mb-4",children:d}),e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:t.map((n,c)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-10 w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[n.eventId?e.jsx(N,{to:`${v}/${r}/event/${n.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[n.title,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:n.title}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:n.date}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:n.description})]})]},c))})]})}function F({person1Events:o,person2Events:d,person1Name:r,person2Name:a,lang:t}){const n=b(o,t),c=b(d,t),h=n.map(s=>({...s,person:r,personIndex:1,eventKey:s.eventId||`${s.date}-${s.title}`})),f=c.map(s=>({...s,person:a,personIndex:2,eventKey:s.eventId||`${s.date}-${s.title}`})),u=new Map;h.forEach(s=>{u.set(s.eventKey,{person1Event:s,person2Event:null,date:s.date,eventId:s.eventId})}),f.forEach(s=>{if(u.has(s.eventKey)){const i=u.get(s.eventKey);i.person2Event=s}else u.set(s.eventKey,{person1Event:null,person2Event:s,date:s.date,eventId:s.eventId})});const y=Array.from(u.values()).sort((s,i)=>{const l=parseInt(s.date.split("-")[0]),p=parseInt(i.date.split("-")[0]);return l-p});return e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:x("comparativeTimeline",t)}),e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-600 mr-2"}),e.jsx("span",{className:"mr-6 font-medium",children:r}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-600 mr-2"}),e.jsx("span",{className:"font-medium",children:a})]}),e.jsx("div",{className:"relative border-l-2 border-gray-300 dark:border-gray-700 ml-4 pl-8 space-y-10",children:y.map((s,i)=>{const{person1Event:l,person2Event:p}=s,j=l&&p,m=l||p;if(!m)return null;const E=j?"bg-purple-600":l?"bg-blue-600":"bg-red-600";return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-10 w-6 h-6 rounded-full ${E} flex items-center justify-center`,children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsxs("div",{children:[m.eventId?e.jsx(N,{to:`${v}/${t}/event/${m.eventId}`,className:"inline-block",children:e.jsxs("h4",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:[j?m.title:`${m.person}: ${m.title}`,e.jsx("span",{className:"ml-1 text-gray-400",children:"→"})]})}):e.jsx("h4",{className:"text-lg font-semibold",children:j?m.title:`${m.person}: ${m.title}`}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[m.date,j&&e.jsxs("span",{className:"font-medium ml-2",children:["• ",x("participatedBy",t)," ",r," & ",a]})]}),j?e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[r,": "]}),l.description]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600 mr-2 mt-1.5 flex-shrink-0"}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsxs("span",{className:"font-medium",children:[a,": "]}),p.description]})]})]}):e.jsx("p",{className:"text-gray-800 dark:text-gray-200",children:m.description})]})]},i)})})]})}function z({relationship:o,lang:d}){const r=b(o,d);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:e.jsx(N,{to:`${v}/${d}/figure/${r.personId}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:r.name})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.relationship})]})}),e.jsx("h4",{className:"text-md font-semibold mb-2",children:x("keyInteractions",d)}),e.jsx("ul",{className:"space-y-2",children:r.interactions.map((a,t)=>e.jsx(S,{interaction:a},t))})]})}function S({interaction:o}){return e.jsxs("li",{className:"flex",children:[e.jsx("div",{className:"w-16 flex-shrink-0 text-sm text-gray-600 dark:text-gray-400",children:o.date}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:o.description})]})}function D({currentFigure:o,allFigures:d,lang:r}){const[a,t]=g.useState(""),[n,c]=g.useState(null),[h,f]=g.useState(!1);g.useEffect(()=>{if(n&&a){const s=d.find(i=>i.id===a);s?c(s):(async()=>{try{const l=await k(a);if(l){const p=b(l,r);c(p)}}catch(l){console.error("Error updating comparison figure:",l)}})()}},[r,d,a]);const u=async()=>{if(a){f(!0);try{const s=d.find(i=>i.id===a);if(s)c(s);else{const i=await k(a);if(i){const l=b(i,r);c(l)}else console.error("No figure found with ID:",a)}}catch(s){console.error("Error loading comparison figure:",s)}finally{f(!1)}}},y=()=>{c(null),t("")};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{className:"flex-1 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200",value:a,onChange:s=>t(s.target.value),disabled:h||!!n,children:[e.jsxs("option",{value:"",children:[x("compareWith",r),"..."]}),d.filter(s=>s.id!==o.id).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),n?e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:x("clearComparison",r)}):e.jsx("button",{onClick:u,disabled:!a||h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:h?e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-1"}):x("compare",r)})]}),n&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:[x("comparingWith",r)," ",e.jsx("span",{className:"font-medium",children:n.name})]}),n?e.jsx(F,{person1Events:o.lifeEvents,person2Events:n.lifeEvents,person1Name:o.name,person2Name:n.name,lang:r}):e.jsx(C,{events:o.lifeEvents,title:"",lang:r})]})}const P=w(function(){const d=I(),r=d.id,a=d.lang==="zh"?"zh":"en",[t,n]=g.useState(null),[c,h]=g.useState([]),[f,u]=g.useState(!0),[y,s]=g.useState(null);return g.useEffect(()=>{async function i(){try{u(!0);const[l,p]=await Promise.all([k(r),$()]);if(l){const j=b(l,a),m=b(p,a);n(j),h(m)}else s("Figure not found")}catch(l){s("Error loading figure data"),console.error(l)}finally{u(!1)}}i()},[r,a]),f?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:"Loading..."}):y||!t?e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:["Error: ",y||"Figure not found"]}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(N,{to:`${v}/${a}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:["← ",x("backToHome",a)]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 mb-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:t.name}),e.jsxs("div",{className:"text-lg text-gray-600 dark:text-gray-400 mb-4",children:[t.birth," - ",t.death||x("present",a)]}),e.jsx("div",{className:"mb-6",children:t.titles.map((i,l)=>e.jsx("span",{className:"inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm px-3 py-1 rounded-full mr-2 mb-2",children:i},l))}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3",children:x("biography",a)}),e.jsx("p",{className:"mb-6",children:t.biography}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:x("significance",a)}),e.jsx("p",{children:t.significance})]})]}),e.jsx("div",{className:"w-full md:w-64 h-80 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:t.name})})]}),e.jsxs("div",{className:"my-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:x("lifeEvents",a)}),e.jsx(D,{currentFigure:t,allFigures:c,lang:a})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4 mt-10",children:x("keyRelationships",a)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.relationships.map((i,l)=>e.jsx(z,{relationship:i,lang:a},l))})]})});export{P as default};
